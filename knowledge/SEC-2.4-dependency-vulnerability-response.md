# SEC-2.4 Dependency Vulnerability Response Standard

**Policy ID:** SEC-2.4  
**Category:** Security  
**Status:** Active  
**Effective Date:** 2024-01-01  
**Last Review:** 2025-06-15  
**Owner:** Security Engineering  

---

## 1. Purpose & Scope

### 1.1 Purpose
Define requirements for detecting, triaging, and remediating vulnerabilities in third-party dependencies to:
- Minimize exposure window for known vulnerabilities
- Ensure consistent response across all services
- Maintain compliance with security standards (SOC2, ISO27001)
- Reduce supply chain risk

### 1.2 Scope
- All direct and transitive dependencies
- All programming languages and package managers
- All runtime environments (production, staging, development)

---

## 2. Requirements

### 2.1 Dependency Management (MUST)

| Requirement | Description |
|-------------|-------------|
| Version Pinning | All dependencies MUST be version-pinned |
| Lockfiles | Projects MUST use lockfiles (requirements.txt, package-lock.json, etc.) |
| Private Registry | Production deployments SHOULD use private package registry mirrors |
| Signature Verification | Package signatures SHOULD be verified where supported |

**Example - Python:**
```txt
# requirements.txt - ALL versions pinned
fastapi==0.115.0
uvicorn==0.30.6
pydantic==2.8.2
structlog==24.2.0
httpx==0.27.0
```

### 2.2 Vulnerability Scanning (MUST)

| Scan Type | Frequency | Tools |
|-----------|-----------|-------|
| CI/CD | Every PR, every merge | Dependabot, Snyk, Trivy |
| Scheduled | Daily | Dependabot, OSV-Scanner |
| Pre-deployment | Every release | Container scanning, SBOM analysis |

### 2.3 Response SLAs (MUST)

| Severity | CVSS Score | Ticket Creation | Remediation |
|----------|------------|-----------------|-------------|
| **Critical** | 9.0 - 10.0 | 4 hours | 24 hours |
| **High** | 7.0 - 8.9 | 24 hours | 72 hours (3 days) |
| **Medium** | 4.0 - 6.9 | 72 hours | 168 hours (7 days) |
| **Low** | 0.1 - 3.9 | 168 hours | 720 hours (30 days) |

### 2.4 Remediation Process (MUST)

1. **Detection** - Automated scan identifies vulnerability
2. **Triage** - Security team validates and prioritizes
3. **Ticket Creation** - Within SLA, include:
   - CVE ID and description
   - Affected service(s) and version(s)
   - CVSS score and attack vector
   - Fixed version(s) available
   - Risk assessment
4. **Remediation PR** - Include:
   - Minimal version bump to fixed version
   - Updated lockfile
   - Test evidence (unit, integration)
   - Security scan results (clean)
5. **Review & Merge** - Security approval for Critical/High
6. **Deployment** - Per deployment policy (canary for Critical)
7. **Verification** - Post-deployment scan confirms fix

---

## 3. Implementation Patterns

### 3.1 CI/CD Integration (GitHub Actions)

```yaml
# .github/workflows/security-scan.yml
name: Security Scan

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  schedule:
    - cron: '0 6 * * *'  # Daily at 6 AM UTC

jobs:
  dependency-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install safety pip-audit
      
      # Scan with multiple tools for coverage
      - name: Run Safety scan
        run: safety check --full-report --output json > safety-report.json
        continue-on-error: true
      
      - name: Run pip-audit
        run: pip-audit --format json --output pip-audit-report.json
        continue-on-error: true
      
      - name: Check for Critical/High vulnerabilities
        run: |
          # Parse results and fail if Critical/High found
          python scripts/check_vulnerabilities.py
      
      - name: Upload scan results
        uses: actions/upload-artifact@v4
        with:
          name: security-scan-results
          path: |
            safety-report.json
            pip-audit-report.json

  container-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Build container
        run: docker build -t app:scan .
      
      - name: Run Trivy scan
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'app:scan'
          format: 'sarif'
          output: 'trivy-results.sarif'
          severity: 'CRITICAL,HIGH'
          exit-code: '1'  # Fail on Critical/High
```

### 3.2 Vulnerability Check Script

```python
#!/usr/bin/env python3
"""
scripts/check_vulnerabilities.py
Validates scan results against SEC-2.4 policy.
"""
import json
import sys
from pathlib import Path

# SLA thresholds
BLOCK_ON_SEVERITY = {"CRITICAL", "HIGH"}

def load_safety_results(path: Path) -> list[dict]:
    """Load Safety scan results."""
    if not path.exists():
        return []
    with open(path) as f:
        data = json.load(f)
    return data.get("vulnerabilities", [])

def load_pip_audit_results(path: Path) -> list[dict]:
    """Load pip-audit scan results."""
    if not path.exists():
        return []
    with open(path) as f:
        data = json.load(f)
    return data.get("dependencies", [])

def check_results() -> int:
    """Check scan results and return exit code."""
    blocking_vulns = []
    
    # Check Safety results
    safety_vulns = load_safety_results(Path("safety-report.json"))
    for vuln in safety_vulns:
        severity = vuln.get("severity", "UNKNOWN").upper()
        if severity in BLOCK_ON_SEVERITY:
            blocking_vulns.append({
                "source": "safety",
                "package": vuln.get("package_name"),
                "cve": vuln.get("vulnerability_id"),
                "severity": severity,
                "fixed_version": vuln.get("fixed_versions", []),
            })
    
    # Check pip-audit results  
    audit_deps = load_pip_audit_results(Path("pip-audit-report.json"))
    for dep in audit_deps:
        for vuln in dep.get("vulns", []):
            severity = vuln.get("fix_versions") and "HIGH" or "MEDIUM"
            if severity in BLOCK_ON_SEVERITY:
                blocking_vulns.append({
                    "source": "pip-audit",
                    "package": dep.get("name"),
                    "cve": vuln.get("id"),
                    "severity": severity,
                    "fixed_version": vuln.get("fix_versions", []),
                })
    
    if blocking_vulns:
        print("=" * 60)
        print("BLOCKING VULNERABILITIES FOUND (SEC-2.4 Policy)")
        print("=" * 60)
        for v in blocking_vulns:
            print(f"\n  Package: {v['package']}")
            print(f"  CVE: {v['cve']}")
            print(f"  Severity: {v['severity']}")
            print(f"  Fixed in: {v['fixed_version']}")
        print("\n" + "=" * 60)
        print("ACTION REQUIRED: Upgrade vulnerable packages before merge")
        print("=" * 60)
        return 1
    
    print("No blocking vulnerabilities found.")
    return 0

if __name__ == "__main__":
    sys.exit(check_results())
```

### 3.3 Remediation PR Template

```markdown
## Vulnerability Remediation

### Summary
This PR remediates [CRITICAL/HIGH] severity vulnerabilities in dependencies.

### Vulnerabilities Addressed

| Package | CVE | Severity | CVSS | Old Version | Fixed Version |
|---------|-----|----------|------|-------------|---------------|
| requests | CVE-2023-32681 | MEDIUM | 6.1 | 2.28.0 | 2.31.0 |
| cryptography | CVE-2023-38325 | HIGH | 7.5 | 40.0.0 | 41.0.2 |

### Risk Assessment
- **Exploitability:** [NETWORK/LOCAL/ADJACENT]
- **Attack Complexity:** [LOW/HIGH]
- **Privileges Required:** [NONE/LOW/HIGH]
- **User Interaction:** [NONE/REQUIRED]

### Changes Made
- Updated `requirements.txt` with fixed versions
- Regenerated lockfile
- Verified no breaking API changes in upgraded packages

### Testing Evidence
- [ ] Unit tests pass
- [ ] Integration tests pass
- [ ] Security scan (post-fix) shows no Critical/High
- [ ] Manual smoke test in staging

### Rollback Plan
If issues detected post-deployment:
1. Revert this PR
2. Redeploy previous version
3. Reassess remediation approach

### References
- [CVE-2023-32681](https://nvd.nist.gov/vuln/detail/CVE-2023-32681)
- [CVE-2023-38325](https://nvd.nist.gov/vuln/detail/CVE-2023-38325)
- [SEC-2.4 Policy](../knowledge/SEC-2.4-dependency-vulnerability-response.md)
```

---

## 4. Safe Upgrade Guidelines

### 4.1 Upgrade Strategy

1. **Minimal Bump** - Prefer smallest version increment that includes fix
2. **Changelog Review** - Check for breaking changes
3. **Dependency Tree** - Verify transitive dependencies updated
4. **Test Coverage** - Run full test suite
5. **Staged Rollout** - Canary deployment for Critical fixes

### 4.2 Testing Requirements

| Severity | Unit Tests | Integration | Smoke Test | Canary |
|----------|------------|-------------|------------|--------|
| Critical | ✅ | ✅ | ✅ | ✅ |
| High | ✅ | ✅ | ✅ | ⚡ Recommended |
| Medium | ✅ | ✅ | ⚡ | ❌ |
| Low | ✅ | ⚡ | ❌ | ❌ |

---

## 5. Exceptions & Waivers

### 5.1 Waiver Process
If a vulnerability cannot be remediated within SLA:

1. Create exception request with:
   - Business justification
   - Compensating controls
   - Remediation timeline
2. Security team review (within 24 hours)
3. CISO approval for Critical waivers
4. Document in security exception register
5. Set follow-up review date

### 5.2 Compensating Controls
When patching is delayed:
- Network segmentation
- WAF rules
- Enhanced monitoring
- Input validation hardening
- Feature flag disablement

---

## 6. Metrics & Reporting

### 6.1 Key Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Mean Time to Remediate (Critical) | < 24 hours | Ticket creation to deployment |
| Mean Time to Remediate (High) | < 72 hours | Ticket creation to deployment |
| Vulnerability Escape Rate | 0% | Critical/High reaching production |
| Scan Coverage | 100% | Services with automated scanning |

### 6.2 Reporting
- Weekly vulnerability summary to Engineering leadership
- Monthly security posture report to CISO
- Quarterly trend analysis

---

## 7. References

- [NIST NVD](https://nvd.nist.gov/)
- [OSV Database](https://osv.dev/)
- [OWASP Dependency-Check](https://owasp.org/www-project-dependency-check/)
- [CIS Software Supply Chain Security Guide](https://www.cisecurity.org/)
